<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
        content="DynaMem is an open vocbulary mobile manipulation (OVMM) system that adapts a spatio semantic memory to dynamically changing environments for robot navigation.">
    <meta name="keywords"
        content="Home robotics, Home robots, Spatio Semantic Memory, DynaMem, Open-knowledge robots, Open source robot learning">
    <link rel="author" href="https://peiqi-liu.github.io/" />
    <title>DynaMem: Online Dynamic Spatio-Semantic Memory for
        Open World Mobile Manipulations</title>
    <meta property="og:url" content="https://dynamem.github.io/">
    <meta property="og:image" content="https://dynamem.github.io/mfiles/preview.gif">
    <meta property="og:description"
        content="DynaMem is an OVMM system adapting a spatio semantic memory to dynamically changing environments.">
    <meta property="og:title" content="DynaMem: Online Dynamic Spatio-Semantic Memory for
    Open World Mobile Manipulation">
    <meta property="og:site_name" content="DynaMem: Online Dynamic Spatio-Semantic Memory for
        Open World Mobile Manipulation">
    <meta property="og:see_also" content="https:/dynamem.github.io/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https:/dynamem.github.io/">
    <meta name="twitter:title" content="DynaMem: Online Dynamic Spatio-Semantic Memory for
        Open World Mobile Manipulation">
    <meta name="twitter:description"
        content="DynaMem is an OVMM system adapting a spatio semantic memory to dynamically changing environments.">
    <meta name="twitter:image" content="https:/dynamem.github.io/mfiles/preview.gif">
    <meta name="twitter:image:alt" content="DynaMem: Online Dynamic Spatio-Semantic Memory for
        Open World Mobile Manipulation">
    <meta name="twitter:site" content="@LIUPEIQI2">
    <meta name="twitter:player" content="https:/dynamem.github.io/mfiles/mosaic_extended.mp4">
    <meta name="twitter:player:width" content="1280">
    <meta name="twitter:player:height" content="720">
    <meta name="twitter:player:stream" content="https:/dynamem.github.io/mfiles/mosaic_extended.mp4">
    <meta name="twitter:player:stream:content_type" content="video/mp4">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans',
                sans-serif;
        }

        .hero-text {
            font-size: 5rem;
        }

        .hero-icon {
            height: 4rem;
        }

        .hero-subtitle {
            font-size: 2rem;
            font-style: italic;
        }

        .hero-subtext {
            font-size: 1.5rem;
        }

        /* Media query for tablet and smaller, make hero text 23vw */
        @media screen and (max-width: 767px) {
            .hero-text {
                font-size: 15vw;
            }

            .hero-icon {
                height: 12vw;
            }

            .hero-subtitle {
                font-size: 6vw;
            }

            .hero-subtext {
                font-size: 4vw;
            }

            .has-text-success-dark.is-size-4 {
                font-size: 4.5vw !important;
            }
        }

        .nav-link {
            font-size: 1.25rem;
        }

        #nav {
            position: sticky;
            top: 0;
        }

        #failure_chart {
            /* width: 50%; */
            margin-left: auto;
            margin-right: auto;
        }

        .caption {
            font-size: 1rem;
            /* horizontal position overlaid on the previous class */
            position: relative;
            text-align: center;
            left: 0rem;
            background-color: rgba(22, 49, 68, 0.5);
            border-radius: 0.25rem;
        }

        .authors a {
            text-decoration: underline;
        }

        video.is-square-video {
            aspect-ratio: 1 / 1;
        }

        video.is-loading {
            background: rgba(0, 0, 0, 0.5) url(mfiles/images/puff.svg) center center no-repeat;
        }

        #selected_video {
            aspect-ratio: 16 / 9;
            max-height: 540px;
        }

        @media (orientation:landscape) {
            .hide-on-landscape {
                display: none;
            }
        }

        @media (orientation:portrait) {
            .hide-on-portrait {
                display: none;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar" role="navigation" aria-label="main navigation" id="nav">
        <div class="navbar-brand">
            <a class="navbar-item is-success nav-link is-size-3" href="#">
                <!-- <span class="icon"><img src="mfiles/logo.svg"></img></span> -->
                <span>DynaMem</span>
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div id="navMenu" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item link is-info nav-link" href="#videos">
                    <div class="icon-text">
                        <span>Videos</span>
                    </div>
                </a>
                <!-- <a class="navbar-item link is-info nav-link" href="#hardware">
                    <div class="icon-text">
                        <span>Hardware</span>
                    </div>
                </a> -->
                <!-- <a class="navbar-item link is-info nav-link" href="#dataset">
                    <div class="icon-text">
                        <span>Dataset</span>
                    </div>
                </a> -->
                <a class="navbar-item link is-info nav-link" href="#method">
                    <div class="icon-text">
                        <span>Method</span>
                    </div>
                </a>
                <a class="navbar-item link is-info nav-link" href="#evaluation">
                    <div class="icon-text">
                        <span>Evaluation</span>
                    </div>
                </a>
                <a class="navbar-item link is-info nav-link" href="#paper">
                    <div class="icon-text">
                        <span>Paper</span>
                    </div>
                </a>
                <a class="navbar-item link is-info nav-link" href="#code">
                    <div class="icon-text">
                        <span>Code</span>
                    </div>
                </a>
            </div>
            <!-- <div class="navbar-end">
                <a class="navbar-item link is-info nav-link" href="https://docs.dobb-e.com/contact-us" target="_blank">
                    <span>Contact us</span>
                </a>
                <div class="navbar-item">
                    <div class="buttons">
                        <a class="button is-info" href="https://discord.gg/wzzZJxqKYC" target="_blank">
                            <span class="icon-text">
                                <span class="icon">
                                    <img src="mfiles/discord.svg" style="height: 1.5rem;"></img>
                                </span>
                                <span>Questions? Ask on Discord</span>
                            </span>
                        </a>
                    </div>
                </div>
            </div> -->
        </div>
    </nav>
    <div class="hero is-halfheight">
        <div class="hero-body block">
            <div class="container">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            DynaMem
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            Online Dynamic Spatio-Semantic Memory for Open World Mobile Manipulation
                        </h2>
                    </div>
                    <div class="subtitle  is-size-7-mobile is-size-6-tablet block">
                        <p class="authors">
                            <a href="https://peiqi-liu.github.io/" target="_blank">Peiqi Liu</a>,
                            <a href="https://www.linkedin.com/in/zhanqiu-guo-b932b624b/" target="_blank">Zhanqiu
                                Guo</a>,
                            <a href="https://www.linkedin.com/in/mohit-warke/" target="_blank">Mohit Warke</a>,
                            <a href="https://soumith.ch/" target="_blank">Soumith Chintala</a>,
                            <a href="https://cpaxton.github.io/" target="_blank">Chris Paxton</a>,
                            <a href="https://mahis.life" target="_blank">Nur Muhammad "Mahi" Shafiullah<sup>†</sup></a>,
                            <a href="https://lerrelpinto.com/" target="_blank">Lerrel Pinto<sup>†</sup></a>
                        </p>
                        <p class="authors">†: Equal advising</p>
                    </div>
                </div>
                <div class="container block">
                    <a class="button is-info is-outlined is-responsive" href="#videos">
                        <span class="icon">
                            <ion-icon name="videocam-outline"></ion-icon>
                        </span>
                        <span>DynaMem in the wild</span>
                    </a>
                    <a class="button is-outlined is-responsive" href="#paper">
                        <span class="icon">
                            <ion-icon name="newspaper-outline"></ion-icon>
                        </span>
                        <span>Read the paper</span>
                    </a>
                    <a class="button is-outlined is-responsive" target="_blank"
                        href="https://github.com/peiqi-liu/stretch_ai/tree/experiment">
                        <span class="icon">
                            <ion-icon name="logo-github"></ion-icon>
                        </span>
                        <span>GitHub repo</span>
                    </a>
                    <!-- <a class="button is-outlined is-responsive" target="_blank" href="https://discord.gg/wzzZJxqKYC">
                        <span class="icon">
                            <img src="mfiles/discord-black.svg" style="height: 1.5rem;"></img>
                        </span>
                        <span>Discord server</span>
                    </a> -->
                </div>
                <div class="columns block">
                    <div class="column">
                        <figure>
                            <video muted autoplay playsinline loop controls src="mfiles/DynaMem-peiqi-home.mp4"></video>
                        </figure>
                    </div>
                    <div class="column">
                        <figure>
                            <video muted autoplay playsinline loop controls
                                src="mfiles/DynaMem-nyu-kitchen.mp4"></video>
                        </figure>
                    </div>
                </div>
                <div class="container block columns">
                    <div class="column">
                        <div class="subtitle block is-size-4">
                            <button class="button is-outlined is-responsive" id="expand-abstract">
                                <span class="icon"><ion-icon name="caret-down-outline"
                                        id="expand-abstract-icon"></ion-icon></span><span
                                    id="expand-abstract-text">Expand
                                    abstract</span></button>
                        </div>
                        <div class="is-size-6 block" id="abstract" hidden>
                            <p>
                                Significant progress has been made in open-vocabulary
                                mobile manipulation, where the goal is for a robot
                                to perform tasks in any environment given a natural language
                                description. However, most current systems assume a static
                                environment, which limits the system's applicability in real-
                                world scenarios where environments frequently change due to
                                human intervention or the robot's own actions. In this work,
                                we present DynaMem, a new approach to open-world mobile
                                manipulation that uses a dynamic spatio-semantic memory to
                                represent a robot's environment. DynaMem constructs a 3D
                                data structure to maintain a dynamic memory of point clouds,
                                and answers open-vocabulary object localization queries using
                                multimodal LLMs or open-vocabulary features generated by
                                state-of-the-art vision-language models. Powered by DynaMem,
                                our robots can explore novel environments, search for objects
                                not found in memory, and continuously update the memory
                                as objects move, appear, or disappear in the scene. We run
                                extensive experiments on the Stretch SE3 robots in three real
                                and nine offline scenes, and achieve an average pick-and-drop
                                success rate of 70% on non-stationary objects, which is more
                                than a 2x improvement over state-of-the-art static systems.
                            </p>
                        </div>
                    </div>
                </div>
                <!-- <div class="container block columns">
                    <div class="column">
                        <div class="subtitle is-size-4">
                            <span>OK-Robot, in a nutshell:</span>
                        </div>
                        <div id="nutshell">
                            <figure class="hide-on-portrait">
                                <video style="width:100%" playsinline muted autoplay loop
                                    src="mfiles/whats_happening_comp.mp4"></video>
                            </figure>
                            <figure class="hide-on-landscape">
                                <video style="width:100%" playsinline muted autoplay loop
                                    src="mfiles/whats_happening_vert_comp.mp4"></video>
                            </figure>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </div>
    <!-- Video section -->
    <section class="hero is-halfheight" id="videos">
        <div class="hero-body block">
            <div class="container block">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            Videos
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            DynaMem in action
                        </h2>
                    </div>
                    <div class="subtitle block">
                        <p class="hero-subtext">
                            Here are sample trials from 3 lab environments and 2 home environments.
                        </p>
                    </div>
                </div>
                <div class="container block">
                    <div class="columns">
                        <div class="column is-10">
                            <div class="select" style="display: block;">
                                <select id="video-home-selection" style="width: 100%;">
                                    <option value="Home 1">Home 1</option>
                                    <option value="Home 2">Home 2</option>
                                    <option value="Lab - kitchen">Lab: Kitchen</option>
                                    <option value="Lab - sitting area">Lab: Sitting area</option>
                                    <option value="Lab - game room">Lab: Game room</option>
                                </select>
                            </div>
                        </div>
                        <!-- <div class="column is-3">
                            <div class="select" style="display: block;">
                                <select id="video-home-selection" style="width: 100%;">
                                    <option value="lab-env-1">Lab environments</option>
                                    <option value="lab-env-2">Lab environments</option>
                                    <option value="lab-env-3">Home environments</option>
                                </select>
                            </div>
                        </div>
                        <div class="column is-5">
                            <div class="select" style="display: block;">
                                <select id="video-task-selection" style="width: 100%;">
                                    <option value="0-438">All
                                    </option>
                                    <option value="0-79">Detergent Pack to Red Shopping Bag
                                    </option>
                                    <option value="85-179">Red Navaratna Oil to Table
                                    </option>
                                    <option value="183-275">Blue Moisturizer to Target Bag</option>
                                    <option value="280-355">Purple Shampoo to White Rack</option>
                                    <option value="357-438">Orange Package to Dust Bin</option>
                                </select>
                            </div>
                        </div> -->
                        <div class="column is-2">
                            <button class="button is-info is-outlined" id="shuffle-button" style="width: 100%;">
                                <span class="icon">
                                    <ion-icon name="shuffle-outline"></ion-icon>
                                </span>
                                <span>Shuffle</span>
                        </div>
                    </div>

                </div>
                <div class="block">
                    <div class="columns is-centered">
                        <div class="column is-12-mobile is-10-tablet video-holder">
                            <figure class="">
                                <style>
                                    .embed-container {
                                        position: relative;
                                        padding-bottom: 56.25%;
                                        height: 0;
                                        overflow: hidden;
                                        max-width: 100%;
                                    }

                                    .embed-container iframe,
                                    .embed-container object,
                                    .embed-container embed {
                                        position: absolute;
                                        top: 0;
                                        left: 0;
                                        width: 100%;
                                        height: 100%;
                                    }
                                </style>
                                <div class='embed-container'><iframe id="youtube-embed"
                                        src='https://www.youtube.com/embed/OQKYERcGoWA?fs=0&modestbranding=1&playsinline=1&rel=0&color=white'
                                        frameborder='0' showinfo='0' allowfullscreen></iframe></div>
                            </figure>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="hero is-halfheight" id="method">
        <div class="hero-body block">
            <div class="container">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            Method
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            Illustration of DynaMem
                        </h2>
                    </div>
                    <div class="block">
                        <div class="subtitle">
                            <figure class="block">
                                <picture>
                                    <source type="image/avif" srcset="mfiles/images/overall.avif">
                                    <img src="mfiles/images/overall.jpg" alt="an illustration of DynaMem" />
                                </picture>
                            </figure>
                            <p class="block hero-subtext">
                                We maintain a feature pointcloud as the robot memory.
                                When the robot receives a new RGBD observation of the environment,
                                it adds the newly observed objects and removes the points no longer existing.
                            </p>
                            <p class="block hero-subtext">
                                To ground the object of interest described by the text query,
                                the robot locates the point most similar to text query along with
                                the last image it is observed.
                                If the text is grounded in the image or the point has
                                high similarity with the text, it will be considered as the location of
                                the object of interest.
                            </p>
                            <p class="block hero-subtext">
                                If the text is grounded the environment, the robot will navigate to the target object;
                                otherwise, the robot memory will be projected into a value map and the robot explores
                                the
                                environment based on the value map.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="hero is-halfheight" id="evaluation">
        <div class="hero-body block">
            <div class="container">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            Evaluation
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            Performance of DynaMem
                        </h2>
                    </div>
                    <div class="block">
                        <div class="subtitle">
                            <figure class="block" id="failure_chart">
                                <picture>
                                    <source type="image/avif" srcset="mfiles/images/failure_modes_detailed.avif">
                                    <img src="mfiles/images/failure_modes_detailed.jpg"
                                        alt="performance and failure analysis of DynaMem and baselines" />
                                </picture>
                            </figure>
                            <p class="block hero-subtext">
                                We evaluate DynaMem in 3 different environments, 10 queries from each environment.
                                We select OK-Robot (with prescanned static robot memory) and
                                Gemini (utilized following the pipeline proposed in OpenEQA) as baselines.
                            </p>
                            <p class="block hero-subtext">
                                We find that both DynaMem and mLLM have a total success rate of 70%. This
                                is a significant improvement over the OK-Robot system,
                                which has a total success rate of 30%.
                                Notably, DynaMem is particularly adept at handling dynamic objects in the environment:
                                only 6.7% of the trials failed due to our system not being able to navigate to such
                                dynamic objects in the
                                scene.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Paper -->
    <section class="hero is-halfheight" id="paper">
        <div class="hero-body block">
            <div class="container">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            Paper
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            DynaMem: Online Dynamic Spatio-Semantic Memory for
                            Open World Mobile Manipulations
                        </h2>
                    </div>
                    <div class="columns">
                        <div class="column is-12-mobile">
                            <a href="mfiles/paper/DynaMem.pdf" target=" _blank">
                                <figure class="image">
                                    <picture>
                                        <source type="image/avif" srcset="mfiles/images/paper.avif">
                                        <img src="mfiles/images/paper.jpg" style="max-width: 95vw;" alt="Paper">
                                    </picture>
                                </figure>
                            </a>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column">
                            <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                href="mfiles/paper/DynaMem.pdf">
                                <span class="icon">
                                    <img src="mfiles/images/arxiv.svg" style="height: 1.5rem;"></img>
                                </span>
                                <span>Read the paper (Arxiv)</span>
                            </a>
                        </div>
                        <div class="column">
                            <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                href="mfiles/paper/DynaMem.pdf">
                                <span class="icon">
                                    <ion-icon name="document-text-outline"></ion-icon>
                                </span>
                                <span>Read the paper (PDF)</span>
                            </a>
                        </div>
                        <div class="column">
                            <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                href="/more/bibtex.txt">
                                <span class="icon">
                                    <ion-icon name="bookmark-outline"></ion-icon>
                                </span>
                                <span>Citation (bibtex)</span>
                            </a>
                        </div>
                    </div>
                    <div class="content">
                        <pre id="citation-text" style="max-width: 90vw; overflow-x: auto;">
@article{liu2024dynamem,
  title={DynaMem: Online Dynamic Spatio-Semantic Memory for Open World Mobile Manipulation},
  author={Liu, Peiqi and Guo, Zhanqiu and Warke, Mohit and Chintala, Soumith and Shafiullah, Nur Muhammad Mahi and Pinto, Lerrel},
  journal={arXiv preprint arXiv:2401.12202},
  year={2024}
}
</pre>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Code -->
    <section class="hero is-halfheight" id="code">
        <div class="hero-body block">
            <div class="container">
                <div class="container block">
                    <div class="title block">
                        <h1 class="hero-text">
                            Code
                        </h1>
                    </div>
                    <div class="subtitle block">
                        <h2 class="hero-subtitle">
                            Get the code on github.
                        </h2>
                    </div>
                    <div class="container block">
                        <div class="columns">
                            <div class="column">
                                <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                    href="https://github.com/hello-robot/stretch_ai/tree/feature/dynav/src/stretch/dynav">
                                    <span class="icon">
                                        <ion-icon name="logo-github"></ion-icon>
                                    </span>
                                    <span>GitHub repo</span>
                                </a>
                            </div>
                            <div class="column">
                                <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                    href="https://github.com/hello-robot/stretch_ai/tree/feature/dynav/src/stretch/dynav/tree/main/docs">
                                    <span class="icon">
                                        <ion-icon name="book-outline"></ion-icon>
                                    </span>
                                    <span>Documentation</span>
                                </a>
                            </div>
                            <!-- <div class="column">
                                <a class="button is-outlined is-medium is-fullwidth" target="_blank"
                                    href="https://discord.gg/wzzZJxqKYC">
                                    <span class="icon">
                                        <img src="mfiles/discord-black.svg" style="height: 1.5rem;"></img>
                                    </span>
                                    <span>Questions? Ask on Discord</span>
                                </a>
                            </div> -->
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Footer -->
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>DynaMem</strong> by <a href="https://peiqi-liu.github.io">Peiqi Liu</a> and <a
                    href="https://mahis.life">Mahi Shafiullah</a>.
                The source code is licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The
                website content is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC ANS 4.0</a>.
                The
                website template is taken from <a href="https://ok-robot.github.io">OK-Robot</a>.
            </p>
        </div>
    </footer>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

<script>
    const videoData = [
        {
            "Environment": "Home 1",
            // "Picking Object": "Purple Medicine",
            // "Placing Object": "Chair",
            // "ST": 0,
            // "ET": 70
        },
        {
            "Environment": "Home 2",
            // "Picking Object": "Purple Medicine",
            // "Placing Object": "Chair",
            // "ST": 0,
            // "ET": 70
        },
        {
            "Environment": "Lab - kitchen",
            // "Picking Object": "Purple Medicine",
            // "Placing Object": "Chair",
            // "ST": 0,
            // "ET": 70
        },
        {
            "Environment": "Lab - sitting area",
            // "Picking Object": "Eye glass Case",
            // "Placing Object": "Chair",
            // "ST": 73,
            // "ET": 149
        },
        {
            "Environment": "Lab - game room",
            // "Picking Object": "Grey Rag",
            // "Placing Object": "Sink",
            // "ST": 152,
            // "ET": 226
        },
    ];
    // Create a mapping from env name to array of slices.
    const taskRollouts = {};
    videoData.forEach((video) => {
        if (!(video.Environment in taskRollouts)) {
            taskRollouts[video.Environment] = [];
        }
        taskRollouts[video.Environment].push(video);
    });
    console.log(taskRollouts);
    const YTVideoPrefix = "https://www.youtube.com/embed/";
    const YTVideoSuffix = "?fs=0&modestbranding=1&playsinline=1&rel=0&color=white";
    const YTVideoID = {
        "Home 1": "OQKYERcGoWA",
        "Home 2": "TYROXQSXZyA",
        "Lab - kitchen": "_WIQhlZ2QWs",
        "Lab - sitting area": "sabw032HgDA",
        "Lab - game room": "qXc-HWhMJAo",
    }


    document.addEventListener('DOMContentLoaded', () => {

        // Get all "navbar-burger" elements
        const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

        // Add a click event on each of them
        $navbarBurgers.forEach(el => {
            el.addEventListener('click', () => {

                // Get the target from the "data-target" attribute
                const target = el.dataset.target;
                const $target = document.getElementById(target);

                // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
                el.classList.toggle('is-active');
                $target.classList.toggle('is-active');
            });
        });

        const $navbarItems = Array.prototype.slice.call(document.querySelectorAll('.navbar-item'), 0);
        $navbarItems.forEach(el => {
            el.addEventListener('click', () => {
                const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
                $navbarBurgers.forEach(el => {
                    const target = el.dataset.target;
                    const $target = document.getElementById(target);
                    el.classList.remove('is-active');
                    $target.classList.remove('is-active');
                });
            });
        });


        // Add listeners for the video selection.
        // const taskSelection = document.getElementById('video-task-selection');
        // const homeSelection = document.getElementById('video-home-selection');
        // const videoSelection = document.getElementById('youtube-embed');
        // taskSelection.addEventListener("change", function (event) {
        //     const task = event.target.value;
        //     const home = homeSelection.value;
        //     const properHomeName = homeSelection.value;
        //     // Calculate start, end from the value.
        //     const [start, end] = task.split('-');
        //     const videoSelection = document.getElementById('youtube-embed');
        //     videoSelection.src = `${YTVideoPrefix}${YTVideoID[properHomeName]}${YTVideoSuffix}&start=${start}&end=${end}`;
        // });

        const homeSelection = document.getElementById('video-home-selection');
        const videoSelection = document.getElementById('youtube-embed');
        homeSelection.addEventListener("change", function (event) {
            const home = event.target.value;
            const properHomeName = homeSelection.value;
            // Calculate start, end from the value.
            // const [start, end] = task.split('-');
            const videoSelection = document.getElementById('youtube-embed');
            // videoSelection.src = `${YTVideoPrefix}${YTVideoID[properHomeName]}${YTVideoSuffix}&start=${start}&end=${end}`;
            videoSelection.src = `${YTVideoPrefix}${YTVideoID[properHomeName]}${YTVideoSuffix}`;
        });

        function updateTaskList(home) {
            const videos = taskRollouts[home];
            // Now change the options for task selection
            const taskSelection = document.getElementById('video-task-selection');
            taskSelection.innerHTML = '';

            const option = document.createElement('option');
            option.value = `0-${videos[4].ET}`;
            option.innerText = `All`;
            taskSelection.appendChild(option);
            videos.forEach((video) => {
                const option = document.createElement('option');
                option.value = `${video.ST}-${video.ET}`;
                option.innerText = `${video["Picking Object"]} to ${video["Placing Object"]}`;
                taskSelection.appendChild(option);
            });
            return videos[0];
        }
        homeSelection.addEventListener("change", function (event) {
            const properHomeName = this.value;
            // video = updateTaskList(properHomeName);
            const videoSelection = document.getElementById('youtube-embed');
            videoSelection.src = `${YTVideoPrefix}${YTVideoID[properHomeName]}${YTVideoSuffix}`;
        });

        // Add shuffle option
        function shuffleVideo() {
            const randomHome = Object.keys(YTVideoID)[Math.floor(Math.random() * Object.keys(YTVideoID).length)];
            console.log(randomHome);
            const randomTask = taskRollouts[randomHome][Math.floor(Math.random() * taskRollouts[randomHome].length)];
            const videoSelection = document.getElementById('youtube-embed');
            homeSelection.value = randomTask.Environment;
            // updateTaskList(randomTask.Environment);
            // taskSelection.value = `${randomTask.ST}-${randomTask.ET}`;
            // videoSelection.src = `${YTVideoPrefix}${YTVideoID[randomHome]}${YTVideoSuffix}&start=${randomTask.ST}&end=${randomTask.ET}`;
            videoSelection.src = `${YTVideoPrefix}${YTVideoID[randomHome]}${YTVideoSuffix}`;
        }
        // shuffleVideo();
        const shuffleButton = document.getElementById('shuffle-button');
        shuffleButton.addEventListener('click', shuffleVideo);
        // Toggle abstract when expand button is clicked
        const expandButton = document.getElementById('expand-abstract');
        const expandButtonText = document.getElementById('expand-abstract-text');
        const expandButtonIcon = document.getElementById('expand-abstract-icon');
        const abstract = document.getElementById('abstract');
        expandButton.addEventListener('click', function (event) {
            abstract.hidden = !abstract.hidden;
            if (abstract.hidden) {
                expandButtonText.innerText = 'Show abstract';
                expandButtonIcon.name = "caret-down-outline";
            } else {
                expandButtonText.innerText = 'Hide abstract';
                expandButtonIcon.name = "caret-forward-outline";
            }
        });
    });

    // document.getElementById('citation-text').addEventListener('click', function () {
    //     if (window.getSelection) {
    //         var range = document.createRange();
    //         range.selectNodeContents(this);
    //         var selection = window.getSelection();
    //         selection.removeAllRanges();
    //         selection.addRange(range);
    //     }
    // });

</script>

</html>
